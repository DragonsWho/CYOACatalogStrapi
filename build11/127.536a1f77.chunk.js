"use strict";(self.webpackChunkmy_project=self.webpackChunkmy_project||[]).push([[127],{80127:(Y,A,s)=>{s.d(A,{ProtectedListPage:()=>_s});var t=s(92132),P=s(21272),L=s(11273),c=s(42455),I=s(38413),B=s(55356),R=s(74773),E=s(85829),d=s(85963),o=s(4198),r=s(94061),i=s(35513),M=s(40216),U=s(26127),C=s(90361),_=s(33363),W=s(50215),K=s(98765),f=s(25641),k=s(83997),Z=s(95579),z=s(88353),w=s(53563),q=s(49654),l=s(12973),y=s(5194),H=s(50612),ss=s(41909),ts=s(36481),os=s(54894),F=s(17703),as=s(71389),G=s(23045),es=s(51195),Cs=s(15126),Ws=s(63299),Ts=s(67014),vs=s(59080),As=s(79275),Ls=s(14718),cs=s(69267),Is=s(61535),Bs=s(5790),Rs=s(12083),Us=s(35223),Ks=s(5409),fs=s(74930),ys=s(2600),js=s(48940),xs=s(41286),us=s(56336),Ss=s(13426),ps=s(84624),bs=s(77965),$s=s(54257),Ns=s(71210),ks=s(51187),zs=s(39404),Hs=s(58692),Fs=s(501),Gs=s(57646),Js=s(23120),Qs=s(44414),Vs=s(25962),Xs=s(14664),Ys=s(42588),Zs=s(90325),ws=s(62785),qs=s(87443),st=s(41032),tt=s(22957),ot=s(93179),at=s(73055),et=s(15747),nt=s(85306),_t=s(26509),it=s(32058),dt=s(81185),Et=s(82261);const ns=()=>{const[j,D]=P.useState(!1),[is,J]=P.useState(!1),[x,O]=P.useState([]),ds=(0,G.j)(a=>a.admin_app.permissions.settings?.webhooks),{formatMessage:e}=(0,os.A)(),{_unstableFormatAPIError:T}=(0,l.useAPIErrorHandler)(),h=(0,l.useNotification)();(0,l.useFocusWhenNavigate)();const{push:Es}=(0,F.W6)(),{pathname:Q}=(0,F.zy)(),{isLoading:rs,allowedActions:{canCreate:u,canUpdate:S,canDelete:V}}=(0,l.useRBAC)(ds),{notifyStatus:X}=(0,L.W)(),{isLoading:ls,webhooks:g,error:p,updateWebhook:Ms,deleteManyWebhooks:Ps}=(0,es.u)();P.useEffect(()=>{if(p){h({type:"warning",message:T(p)});return}g&&X(e({id:"Settings.webhooks.list.loading.success",defaultMessage:"Webhooks have been loaded"}))},[g,p,h,e,X,T]);const Ds=async a=>{try{const n=await Ms(a);"error"in n&&h({type:"warning",message:T(n.error)})}catch{h({type:"warning",message:{id:"notification.error",defaultMessage:"An error occurred"}})}},Os=async()=>{try{J(!0);const a=await Ps({ids:x});if("error"in a){h({type:"warning",message:T(a.error)});return}O([])}catch{h({type:"warning",message:{id:"notification.error",defaultMessage:"An error occurred"}})}finally{J(!1),D(!1)}},hs=a=>O(a?g?.map(n=>n.id)??[]:[]),gs=(a,n)=>O(a?N=>[...N,n]:N=>N.filter(ms=>ms!==n)),b=a=>()=>Es(`${Q}/${a}`),$=rs||ls,v=g?.length??0,m=x.length;return(0,t.jsxs)(c.P,{children:[(0,t.jsx)(l.SettingsPageTitle,{name:"Webhooks"}),(0,t.jsxs)(I.g,{"aria-busy":$,children:[(0,t.jsx)(B.Q,{title:e({id:"Settings.webhooks.title",defaultMessage:"Webhooks"}),subtitle:e({id:"Settings.webhooks.list.description",defaultMessage:"Get POST changes notifications"}),primaryAction:u&&!$&&(0,t.jsx)(q.z,{as:as.NavLink,startIcon:(0,t.jsx)(y.A,{}),variant:"default",to:`${Q}/create`,size:"S",children:e({id:"Settings.webhooks.list.button.add",defaultMessage:"Create new webhook"})})}),m>0&&V&&(0,t.jsx)(R.B,{startActions:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(E.o,{variant:"epsilon",textColor:"neutral600",children:e({id:"Settings.webhooks.to.delete",defaultMessage:"{webhooksToDeleteLength, plural, one {# webhook} other {# webhooks}} selected"},{webhooksToDeleteLength:m})}),(0,t.jsx)(d.$,{onClick:()=>D(!0),startIcon:(0,t.jsx)(H.A,{}),size:"L",variant:"danger-light",children:e({id:"global.delete",defaultMessage:"Delete"})})]})}),(0,t.jsx)(o.s,{children:$?(0,t.jsx)(r.a,{background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0,children:(0,t.jsx)(l.LoadingIndicatorPage,{})}):v>0?(0,t.jsxs)(i.X,{colCount:5,rowCount:v+1,footer:(0,t.jsx)(M.S,{onClick:b("create"),icon:(0,t.jsx)(y.A,{}),children:e({id:"Settings.webhooks.list.button.add",defaultMessage:"Create new webhook"})}),children:[(0,t.jsx)(U.d,{children:(0,t.jsxs)(C.Tr,{children:[(0,t.jsx)(_.Th,{children:(0,t.jsx)(W.J,{"aria-label":e({id:"global.select-all-entries",defaultMessage:"Select all entries"}),indeterminate:m>0&&m<v,value:m===v,onValueChange:hs})}),(0,t.jsx)(_.Th,{width:"20%",children:(0,t.jsx)(E.o,{variant:"sigma",textColor:"neutral600",children:e({id:"global.name",defaultMessage:"Name"})})}),(0,t.jsx)(_.Th,{width:"60%",children:(0,t.jsx)(E.o,{variant:"sigma",textColor:"neutral600",children:e({id:"Settings.webhooks.form.url",defaultMessage:"URL"})})}),(0,t.jsx)(_.Th,{width:"20%",children:(0,t.jsx)(E.o,{variant:"sigma",textColor:"neutral600",children:e({id:"Settings.webhooks.list.th.status",defaultMessage:"Status"})})}),(0,t.jsx)(_.Th,{children:(0,t.jsx)(K.s,{children:e({id:"Settings.webhooks.list.th.actions",defaultMessage:"Actions"})})})]})}),(0,t.jsx)(f.N,{children:g?.map(a=>(0,t.jsxs)(C.Tr,{onClick:S?b(a.id):void 0,style:{cursor:S?"pointer":"default"},children:[(0,t.jsx)(_.Td,{onClick:n=>n.stopPropagation(),children:(0,t.jsx)(W.J,{"aria-label":`${e({id:"global.select",defaultMessage:"Select"})} ${a.name}`,value:x?.includes(a.id),onValueChange:n=>gs(n,a.id),name:"select"})}),(0,t.jsx)(_.Td,{children:(0,t.jsx)(E.o,{fontWeight:"semiBold",textColor:"neutral800",children:a.name})}),(0,t.jsx)(_.Td,{children:(0,t.jsx)(E.o,{textColor:"neutral800",children:a.url})}),(0,t.jsx)(_.Td,{children:(0,t.jsx)(k.s,{children:(0,t.jsx)(Z.d,{onLabel:e({id:"global.enabled",defaultMessage:"Enabled"}),offLabel:e({id:"global.disabled",defaultMessage:"Disabled"}),label:`${a.name} ${e({id:"Settings.webhooks.list.th.status",defaultMessage:"Status"})}`,selected:a.isEnabled,onChange:n=>{n.stopPropagation(),Ds({...a,isEnabled:!a.isEnabled})},visibleLabels:!0})})}),(0,t.jsx)(_.Td,{children:(0,t.jsxs)(k.s,{gap:1,children:[S&&(0,t.jsx)(z.K,{label:e({id:"Settings.webhooks.events.update",defaultMessage:"Update"}),icon:(0,t.jsx)(ss.A,{}),noBorder:!0}),V&&(0,t.jsx)(z.K,{onClick:n=>{n.stopPropagation(),O([a.id]),D(!0)},label:e({id:"Settings.webhooks.events.delete",defaultMessage:"Delete webhook"}),icon:(0,t.jsx)(H.A,{}),noBorder:!0})]})})]},a.id))})]}):(0,t.jsx)(w.p,{icon:(0,t.jsx)(ts.A,{width:"160px"}),content:e({id:"Settings.webhooks.list.empty.description",defaultMessage:"No webhooks found"}),action:(0,t.jsx)(d.$,{variant:"secondary",startIcon:(0,t.jsx)(y.A,{}),disabled:!u,onClick:u?b("create"):void 0,children:e({id:"Settings.webhooks.list.button.add",defaultMessage:"Create new webhook"})})})})]}),(0,t.jsx)(l.ConfirmDialog,{isOpen:j,onToggleDialog:()=>D(a=>!a),onConfirm:Os,isConfirmButtonLoading:is})]})},_s=()=>{const j=(0,G.j)(D=>D.admin_app.permissions.settings?.webhooks.main);return(0,t.jsx)(l.CheckPagePermissions,{permissions:j,children:(0,t.jsx)(ns,{})})}},51195:(Y,A,s)=>{s.d(A,{u:()=>E});var t=s(23045);const P=t.n.injectEndpoints({endpoints:d=>({getWebhooks:d.query({query:o=>({url:`/admin/webhooks/${o?.id??""}`,method:"GET"}),transformResponse:o=>Array.isArray(o.data)?o.data:[o.data],providesTags:(o,r,i)=>typeof i=="object"&&"id"in i?[{type:"Webhook",id:i.id}]:[...o?.map(({id:M})=>({type:"Webhook",id:M}))??[],{type:"Webhook",id:"LIST"}]}),createWebhook:d.mutation({query:o=>({url:"/admin/webhooks",method:"POST",data:o}),transformResponse:o=>o.data,invalidatesTags:[{type:"Webhook",id:"LIST"}]}),updateWebhook:d.mutation({query:({id:o,...r})=>({url:`/admin/webhooks/${o}`,method:"PUT",data:r}),transformResponse:o=>o.data,invalidatesTags:(o,r,{id:i})=>[{type:"Webhook",id:i}]}),triggerWebhook:d.mutation({query:o=>({url:`/admin/webhooks/${o}/trigger`,method:"POST"}),transformResponse:o=>o.data}),deleteManyWebhooks:d.mutation({query:o=>({url:"/admin/webhooks/batch-delete",method:"POST",data:o}),transformResponse:o=>o.data,invalidatesTags:(o,r,{ids:i})=>i.map(M=>({type:"Webhook",id:M}))})}),overrideExisting:!1}),{useGetWebhooksQuery:L,useCreateWebhookMutation:c,useUpdateWebhookMutation:I,useTriggerWebhookMutation:B,useDeleteManyWebhooksMutation:R}=P,E=(d=void 0,o)=>{const{data:r,isLoading:i,error:M}=L(d,o),[U,{error:C}]=c(),[_,{error:W}]=I(),[K]=B(),[f]=R();return{webhooks:r,isLoading:i,error:M||C||W,createWebhook:U,updateWebhook:_,triggerWebhook:K,deleteManyWebhooks:f}}}}]);
